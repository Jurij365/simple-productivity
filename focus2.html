<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simplest Focus Tracker (IndexedDB)</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #f5f5f5;
      transition: background-color 0.3s ease;
    }

    /* Background colors when active */
    body.focus-active {
      background-color: #d4edda; /* light green */
    }
    body.distract-active {
      background-color: #f8d7da; /* light red */
    }

    h1 {
      margin-bottom: 1.5rem;
    }

    .buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    button {
      padding: 1rem 2rem;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: #fff;
      min-width: 160px;
      transition: transform 0.1s ease-in-out, opacity 0.1s ease-in-out;
    }

    button:active {
      transform: scale(0.97);
    }

    /* Default colors */
    #greenBtn {
      background-color: #28a745;
    }
    #redBtn {
      background-color: #dc3545;
    }

    /* Active/inactive button states */
    .active-btn {
      transform: scale(1.2);
      opacity: 1;
    }
    .inactive-btn {
      transform: scale(0.9);
      opacity: 0.5;
    }

    #stats {
      background-color: #fff;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 400px;
    }

    #stats p {
      margin: 0.5rem 0;
      font-size: 1rem;
    }

    #stats span {
      font-weight: bold;
    }

    /* Stop Work button styling */
    #stopBtn {
      display: none;
      margin-top: 2rem;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border: none;
      border-radius: 6px;
      background-color: #6c757d;
      color: #fff;
      cursor: pointer;
      transition: opacity 0.1s ease-in-out;
    }
    #stopBtn:active {
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <h1>Simplest Focus Tracker</h1>

  <div class="buttons">
    <button id="greenBtn">ðŸŸ¢ I'm focused</button>
    <button id="redBtn">ðŸ”´ I'm distracted</button>
  </div>

  <div id="stats">
    <p>Focused Time: <span id="focusTime">00:00:00</span></p>
    <p>Distracted Time: <span id="distractTime">00:00:00</span></p>
    <p>Focus Percentage: <span id="focusPercent">0.0%</span></p>
  </div>

  <!-- Stop Work button -->
  <button id="stopBtn">Stop Work</button>

  <script>
    // === IndexedDB setup ===
    const DB_NAME = 'FocusTrackerDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'dailyData';
    let db;

    function openDatabase() {
      const request = indexedDB.open(DB_NAME, DB_VERSION);

      request.onupgradeneeded = function(event) {
        db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          db.createObjectStore(STORE_NAME, { keyPath: 'date' });
        }
      };

      request.onsuccess = function(event) {
        db = event.target.result;
        initTracker();
      };

      request.onerror = function(event) {
        console.error('IndexedDB error:', event.target.errorCode);
      };
    }

    function getTodayKey() {
      return new Date().toISOString().slice(0, 10);
    }

    // In-memory state
    let currentDate;
    let focusTime = 0;
    let distractTime = 0;
    let currentState = null;
    let lastSwitchTime = null;

    const greenBtn = document.getElementById('greenBtn');
    const redBtn = document.getElementById('redBtn');
    const stopBtn = document.getElementById('stopBtn');
    const focusTimeEl = document.getElementById('focusTime');
    const distractTimeEl = document.getElementById('distractTime');
    const focusPercentEl = document.getElementById('focusPercent');
    const bodyEl = document.body;

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      const hh = String(hours).padStart(2, '0');
      const mm = String(minutes).padStart(2, '0');
      const ss = String(seconds).padStart(2, '0');
      return `${hh}:${mm}:${ss}`;
    }

    function updateDisplay() {
      const now = Date.now();
      let displayedFocus = focusTime;
      let displayedDistract = distractTime;

      if (currentState === 'focus' && lastSwitchTime !== null) {
        displayedFocus += now - lastSwitchTime;
      } else if (currentState === 'distract' && lastSwitchTime !== null) {
        displayedDistract += now - lastSwitchTime;
      }

      focusTimeEl.textContent = formatTime(displayedFocus);
      distractTimeEl.textContent = formatTime(displayedDistract);
      const total = displayedFocus + displayedDistract;
      const percent = total > 0 ? (displayedFocus / total) * 100 : 0;
      focusPercentEl.textContent = `${percent.toFixed(1)}%`;
    }

    function setVisualState(state) {
      if (state === 'focus') {
        bodyEl.classList.add('focus-active');
        bodyEl.classList.remove('distract-active');
        greenBtn.classList.add('active-btn');
        greenBtn.classList.remove('inactive-btn');
        redBtn.classList.add('inactive-btn');
        redBtn.classList.remove('active-btn');
        stopBtn.style.display = 'block';
      } else if (state === 'distract') {
        bodyEl.classList.add('distract-active');
        bodyEl.classList.remove('focus-active');
        redBtn.classList.add('active-btn');
        redBtn.classList.remove('inactive-btn');
        greenBtn.classList.add('inactive-btn');
        greenBtn.classList.remove('active-btn');
        stopBtn.style.display = 'block';
      } else {
        bodyEl.classList.remove('focus-active', 'distract-active');
        greenBtn.classList.remove('active-btn', 'inactive-btn');
        redBtn.classList.remove('active-btn', 'inactive-btn');
        stopBtn.style.display = 'none';
      }
    }

    function saveCurrentRecord() {
      if (!db) return;
      const tx = db.transaction([STORE_NAME], 'readwrite');
      const store = tx.objectStore(STORE_NAME);
      const data = {
        date: currentDate,
        focusedMs: focusTime,
        distractedMs: distractTime,
        lastState: currentState,
        lastSwitchTime: lastSwitchTime
      };
      store.put(data);
    }

    function initTracker() {
      currentDate = getTodayKey();
      const tx = db.transaction([STORE_NAME], 'readonly');
      const store = tx.objectStore(STORE_NAME);
      const req = store.get(currentDate);
      req.onsuccess = function(event) {
        const res = event.target.result;
        if (res) {
          focusTime = res.focusedMs;
          distractTime = res.distractedMs;
          currentState = res.lastState;
          lastSwitchTime = res.lastSwitchTime;
        } else {
          focusTime = 0;
          distractTime = 0;
          currentState = null;
          lastSwitchTime = null;
          saveCurrentRecord();
        }
        setVisualState(currentState);
        updateDisplay();
        setInterval(tick, 1000);
      };
      req.onerror = function(event) {
        console.error('Error reading todayâ€™s record:', event.target.error);
      };
    }

    function tick() {
      const newDate = getTodayKey();
      if (newDate !== currentDate) {
        currentDate = newDate;
        focusTime = 0;
        distractTime = 0;
        currentState = null;
        lastSwitchTime = null;
        saveCurrentRecord();
        setVisualState(null);
      }
      updateDisplay();
    }

    greenBtn.addEventListener('click', () => {
      const now = Date.now();
      if (currentState === 'focus') return;
      if (currentState === 'distract' && lastSwitchTime !== null) {
        distractTime += now - lastSwitchTime;
      }
      currentState = 'focus';
      lastSwitchTime = now;
      setVisualState('focus');
      saveCurrentRecord();
    });

    redBtn.addEventListener('click', () => {
      const now = Date.now();
      if (currentState === 'distract') return;
      if (currentState === 'focus' && lastSwitchTime !== null) {
        focusTime += now - lastSwitchTime;
      }
      currentState = 'distract';
      lastSwitchTime = now;
      setVisualState('distract');
      saveCurrentRecord();
    });

    stopBtn.addEventListener('click', () => {
      const now = Date.now();
      if (currentState === 'focus' && lastSwitchTime !== null) {
        focusTime += now - lastSwitchTime;
      } else if (currentState === 'distract' && lastSwitchTime !== null) {
        distractTime += now - lastSwitchTime;
      }
      currentState = null;
      lastSwitchTime = null;
      setVisualState(null);
      saveCurrentRecord();
    });

    openDatabase();
  </script>
</body>
</html>